# this file is mean to be parsed by python before being a proper CMakeLists.txt file
# in particular, the following strings will be set by python


# TODO This package depends on as_cpp_potential from pele which adds 
# an unfortunate petsc dependency. This should be fixed.






#################################### petsc #############################################
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake/")
find_package(PETSc REQUIRED)

# find_package(MPI) #make it REQUIRED, if you want

set(MPI_INCLUDE_DIR
  /home/praharsh/.local/include
  CACHE PATH "Location of MPI header files")

set(MPI_LIBRARY_DIR
  /home/praharsh/.local/include
  CACHE PATH "Location of MPI LIBRARIES")

set(MPI_LIBRARIES
  -L${MPI_LIBRARY_DIR})



set(numpy_include __NUMPY_INCLUDE__)
set(PYTHON_INCLUDE_DIRS __PYTHON_INCLUDE__)
set(PYTHON_LDFLAGS "__PYTHON_LDFLAGS__")
set(pele_include __PELE_INCLUDE__)

message("python include dirs: ${PYTHON_INCLUDE_DIRS}")
message("numpy include dirs: ${numpy_include}")
message("pele include dirs: ${pele_include}")
include_directories(${numpy_include})
include_directories(SYSTEM ${MPI_INCLUDE_DIR})
include_directories(${PYTHON_INCLUDE_DIRS})
include_directories(${pele_include})

cmake_minimum_required(VERSION 2.8)

enable_language(CXX)
SET(CMAKE_CXX_FLAGS __COMPILER_EXTRA_ARGS__)

#cmake_policy(SET CMP0015 NEW)

# set the PyCG_DESCENT include directory
set(PyCG_DESCENT_include ${CMAKE_SOURCE_DIR}/source)
include_directories(${PyCG_DESCENT_include})
message("PyCG_DESCENT include directory: ${PyCG_DESCENT_include}")

# build the PyCG_DESCENT library
FILE(GLOB pele_sources ${PyCG_DESCENT_include}/PyCG_DESCENT/*.cpp)
FILE(GLOB PyCG_DESCENT_sources ${PyCG_DESCENT_include}/CG_DESCENT/*.c*)
add_library(PyCG_DESCENT_lib SHARED ${PyCG_DESCENT_sources} ${pele_sources})

function(make_cython_lib cython_cxx_source)
  get_filename_component(library_name ${cython_cxx_source} NAME)
  string(REGEX REPLACE ".cxx$" "" library_name ${library_name})
  add_library(${library_name} SHARED ${cython_cxx_source})
  target_link_libraries(${library_name} PyCG_DESCENT_lib)
  target_link_libraries(${library_name} PkgConfig::PETSC)
  set_target_properties(${library_name} PROPERTIES PREFIX "")
  message("making library ${library_name} from source ${cython_cxx_source}")
endfunction(make_cython_lib)


